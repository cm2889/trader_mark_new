{% extends 'base.html' %}
{% load static %}

{% block title %}Employee Profile - {{ employee.full_name }}{% endblock %}

{% block breadcrumb %}
<span class="mx-1">›</span>
<a href="{% url 'employee:list' %}" class="hover:underline">Employee</a>
<span class="mx-1">›</span>
<span>Profile</span>
{% endblock %}

{% block header_actions %}
<a href="{% url 'employee:list' %}"
    class="inline-flex items-center gap-2 px-4 h-11 text-sm font-medium text-[var(--text-color)] bg-gray-100 rounded-lg hover:bg-gray-200 transition">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7" />
    </svg>
    <span>Back to List</span>
</a>
{% endblock %}


{% block content %}
<div class="container mx-auto px-4 py-6 text-[var(--text-color)]   ">

    <!-- Profile Header -->
    <div class="p-10 rounded-2xl mb-8 shadow-none">
        <h1 class="text-4xl text-[var(--text-color)] mb-2">{{ employee.full_name }}</h1>
        <p class="text-lg mb-1 text-[var(--text-light-color)]">
            <strong>HR File No:</strong> {{ employee.hr_file_no }} |
            <strong>QID No:</strong> {{ employee.qid_no }} |
            <strong>Gender:</strong> {{ employee.get_gender_display }}
        </p>
        <p class="text-lg">
            <strong>Nationality:</strong> {{ employee.nationality.name|default:"N/A" }} |
            <strong>Joined:</strong> {{ employee.joining_at|date:"d M, Y" }}
        </p>
    </div>


    <!-- Employment Information -->
    <div class="  px-5 py-4 border-b-2  my-8 text-2xl rounded-none">
         Employment Information
    </div>

    {% if current_employment %}
    <div
        class="  rounded-xl p-6 mb-6 shadow-none hover:shadow-none transition-all duration-300 hover:-translate-y-1">
        <h3 class=" text-2xl border-b-2  pb-3 mb-5">Current Employment Status</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Work Status</label>
                <div class=" text-lg ">
                    <span
                        class="inline-block px-3 py-1 rounded-full text-sm    border ">
                        {{ current_employment.get_work_status_display }}
                    </span>
                </div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Work Permit No</label>
                <div class=" text-lg ">{{ current_employment.work_permit_no }}</div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Work ID</label>
                <div class=" text-lg ">{{ current_employment.work_id }}</div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">RP Expiry Date</label>
                <div class=" text-lg ">{{ current_employment.rp_expiry_date|date:"d M, Y" }}</div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">QID Renew Status</label>
                <div class=" text-lg ">{{ current_employment.get_qid_renew_status_display }}</div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">QID Lost Status</label>
                <div class=" text-lg ">{{ current_employment.get_qid_lost_status_display }}</div>
            </div>
        </div>
    </div>
    {% endif %}

    {% if employment_history %}
    <div class="  rounded-xl p-6 mb-6 shadow-none">
        <h3 class=" text-2xl border-b-2  pb-3 mb-5">Employment History</h3>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="  border-b-2 ">
                    <tr>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Joining Date</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Work Status</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Work Permit No</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Work ID</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">RP Expiry</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Created At</th>
                    </tr>
                </thead>
                <tbody class="divide-y ">
                    {% for emp in employment_history %}
                    <tr class="hover:bg-gray-100 transition-colors duration-200">
                        <td class="px-4 py-4 ">{{ emp.joining_at|date:"d M, Y" }}</td>
                        <td class="px-4 py-4 ">
                            <span
                                class="inline-block px-3 py-1 rounded-full text-sm    border ">
                                {{ emp.get_work_status_display }}
                            </span>
                        </td>
                        <td class="px-4 py-4 ">{{ emp.work_permit_no }}</td>
                        <td class="px-4 py-4 ">{{ emp.work_id }}</td>
                        <td class="px-4 py-4 ">{{ emp.rp_expiry_date|date:"d M, Y" }}</td>
                        <td class="px-4 py-4 ">{{ emp.created_at|date:"d M, Y" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

 

    <!-- Health Insurance -->
    {% if health_insurance %}
    <div class="  px-5 py-4 border-b-2  my-8 text-2xl rounded-none">
        <i class="fas fa-heartbeat"></i> Health Insurance
    </div>

    <div class="  rounded-xl p-6 mb-6 shadow-none">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Hamad Health
                    Card</label>
                <div class=" text-lg ">
                    <span
                        class="inline-block px-3 py-1 rounded-full text-sm    border ">
                        {% if health_insurance.hamad_health_card %}Yes{% else %}No{% endif %}
                    </span>
                </div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">WM Insurance</label>
                <div class=" text-lg ">{{ health_insurance.get_wm_insurance_display }}</div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Family Health
                    Card</label>
                <div class=" text-lg ">{{ health_insurance.get_family_health_card_display }}</div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- ===================================== -->
    <!-- UNIFORM SECTION -->
    <!-- ===================================== -->
    <!-- ===================================== -->
    <!-- UNIFORM SECTION -->
    <!-- ===================================== -->
    <div class="  px-5 py-4 border-b-2  my-8 text-2xl rounded-none">
         Uniform Management
    </div>

    <!-- Uniform Statistics Summary -->
    <!-- Uniform Statistics Summary -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-5 mb-8">
        <div class="   p-6 rounded-xl shadow-none text-center">
            <h4 class="text-sm  tracking-wide mb-2">Total Issued</h4>
            <p class="text-4xl ">{{ uniform_stats.total_issued }}</p>
        </div>
        <div class="   p-6 rounded-xl shadow-none text-center">
            <h4 class="text-sm  tracking-wide mb-2">Currently Active</h4>
            <p class="text-4xl ">{{ uniform_stats.active }}</p>
        </div>
        <div class="   p-6 rounded-xl shadow-none text-center">
            <h4 class="text-sm  tracking-wide mb-2">Returned</h4>
            <p class="text-4xl ">{{ uniform_stats.returned }}</p>
        </div>
        <div class="   p-6 rounded-xl shadow-none text-center">
            <h4 class="text-sm  tracking-wide mb-2">Lost</h4>
            <p class="text-4xl ">{{ uniform_stats.lost }}</p>
        </div>
        <div class="   p-6 rounded-xl shadow-none text-center">
            <h4 class="text-sm  tracking-wide mb-2">Damaged</h4>
            <p class="text-4xl ">{{ uniform_stats.damaged }}</p>
        </div>
    </div>

    <!-- Uniform Issuance History -->
    {% if uniform_issuances %}
    <div class="  rounded-xl p-6 mb-6 shadow-none">
        <h3 class=" text-2xl border-b-2  pb-3 mb-5">Uniform Issuance History</h3>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="  border-b-2 ">
                    <tr>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Uniform Name</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Type</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Size</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Quantity</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Status</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Issued Date</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Expected Return</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Actual Return</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Remarks</th>
                    </tr>
                </thead>
                <tbody class="divide-y ">
                    {% for issue in uniform_issuances %}
                    <tr class="hover:bg-gray-100 transition-colors duration-200">
                        <td class="px-4 py-4  ">{{ issue.uniform_stock.uniform.name }}</td>
                        <td class="px-4 py-4 ">{{ issue.uniform_stock.uniform.get_uniform_type_display }}</td>
                        <td class="px-4 py-4 ">{{ issue.uniform_stock.get_size_display }}</td>
                        <td class="px-4 py-4  ">{{ issue.quantity }}</td>
                        <td class="px-4 py-4 ">
                            <span
                                class="inline-block px-3 py-1 rounded-full text-sm    border ">
                                {{ issue.get_status_display }}
                            </span>
                        </td>
                        <td class="px-4 py-4 ">{{ issue.issued_date|date:"d M, Y" }}</td>
                        <td class="px-4 py-4 ">{{ issue.expected_return_date|date:"d M, Y"|default:"N/A" }}
                        </td>
                        <td class="px-4 py-4 ">{{ issue.return_date|date:"d M, Y"|default:"N/A" }}</td>
                        <td class="px-4 py-4 ">{{ issue.remark|default:"-" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="text-center py-10  italic bg-gray-100 rounded-xl my-5">No uniform issuance records found
    </div>
    {% endif %}

    <!-- Uniform by Type Breakdown -->
    {% if uniform_by_type %}
    <div class="  rounded-xl p-6 mb-6 shadow-none">
        <h3 class=" text-2xl border-b-2  pb-3 mb-5">Uniform Breakdown by Type</h3>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="  border-b-2 ">
                    <tr>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Uniform Name</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Type</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Size</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Status</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Total Quantity</th>
                    </tr>
                </thead>
                <tbody class="divide-y ">
                    {% for item in uniform_by_type %}
                    <tr class="hover:bg-gray-100 transition-colors duration-200">
                        <td class="px-4 py-4  ">{{ item.uniform_stock__uniform__name }}</td>
                        <td class="px-4 py-4 ">{{ item.uniform_stock__uniform__uniform_type }}</td>
                        <td class="px-4 py-4 ">{{ item.uniform_stock__size }}</td>
                        <td class="px-4 py-4 ">
                            <span
                                class="inline-block px-3 py-1 rounded-full text-sm    border ">
                                {{ item.status }}
                            </span>
                        </td>
                        <td class="px-4 py-4  ">{{ item.total_qty }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Uniform Clearance History -->
    {% if uniform_clearances %}
    <div class="  rounded-xl p-6 mb-6 shadow-none">
        <h3 class=" text-2xl border-b-2  pb-3 mb-5">Uniform Clearance History</h3>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="  border-b-2 ">
                    <tr>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Uniform Name</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Type</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Size</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Quantity</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Status</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Clearance Date</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Remarks</th>
                    </tr>
                </thead>
                <tbody class="divide-y ">
                    {% for clearance in uniform_clearances %}
                    <tr class="hover:bg-gray-100 transition-colors duration-200">
                        <td class="px-4 py-4  ">{{ clearance.uniform_stock.uniform.name }}</td>
                        <td class="px-4 py-4 ">{{ clearance.uniform_stock.uniform.get_uniform_type_display }}
                        </td>
                        <td class="px-4 py-4 ">{{ clearance.uniform_stock.get_size_display }}</td>
                        <td class="px-4 py-4  ">{{ clearance.quantity }}</td>
                        <td class="px-4 py-4 ">
                            <span
                                class="inline-block px-3 py-1 rounded-full text-sm    border ">
                                {{ clearance.get_status_display }}
                            </span>
                        </td>
                        <td class="px-4 py-4 ">{{ clearance.clearance_date|date:"d M, Y" }}</td>
                        <td class="px-4 py-4 ">{{ clearance.remark|default:"-" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- ===================================== -->
    <!-- VEHICLE SECTION -->
    <!-- ===================================== -->
    <!-- ===================================== -->
    <!-- VEHICLE SECTION -->
    <!-- ===================================== -->
    <div class="  px-5 py-4 border-b-2  my-8 text-2xl rounded-none">
         Vehicle Management
    </div>

    <!-- Vehicle Statistics Summary -->
    <!-- Vehicle Statistics Summary -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-5 mb-8">
        <div class="   p-6 rounded-xl shadow-none text-center">
            <h4 class="text-sm  tracking-wide mb-2">Total Vehicles</h4>
            <p class="text-4xl ">{{ vehicle_stats.total_assigned }}</p>
        </div>
        <div class="   p-6 rounded-xl shadow-none text-center">
            <h4 class="text-sm  tracking-wide mb-2">Purchases</h4>
            <p class="text-4xl ">{{ vehicle_stats.total_purchases }}</p>
        </div>
        <div class="   p-6 rounded-xl shadow-none text-center">
            <h4 class="text-sm  tracking-wide mb-2">Total Spent</h4>
            <p class="text-2xl ">{{ vehicle_stats.total_purchase_amount|floatformat:2 }} QR</p>
        </div>
        <div class="   p-6 rounded-xl shadow-none text-center">
            <h4 class="text-sm  tracking-wide mb-2">Violations</h4>
            <p class="text-4xl ">{{ vehicle_stats.total_violations }}</p>
        </div>
        <div class="   p-6 rounded-xl shadow-none text-center">
            <h4 class="text-sm  tracking-wide mb-2">Accidents</h4>
            <p class="text-4xl ">{{ vehicle_stats.total_accidents }}</p>
        </div>
        <div class="   p-6 rounded-xl shadow-none text-center">
            <h4 class="text-sm  tracking-wide mb-2">Maintenance</h4>
            <p class="text-2xl ">{{ vehicle_stats.total_maintenance_cost|floatformat:2 }} QR</p>
        </div>
    </div>

    <!-- Current Vehicle -->
    {% if current_vehicle_assign %}
    <div class="  rounded-xl p-6 mb-6 shadow-none">
        <h3 class=" text-2xl border-b-2  pb-3 mb-5">Current Assigned Vehicle</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Plate Number</label>
                <div class=" text-lg ">{{ current_vehicle_assign.vehicle.plate_no }}</div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Vehicle Type</label>
                <div class=" text-lg ">{{ current_vehicle_assign.vehicle.get_vehicle_type_display }}
                </div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Ownership</label>
                <div class=" text-lg ">{{ current_vehicle_assign.vehicle.get_ownership_display }}
                </div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Assigned Date</label>
                <div class=" text-lg ">{{ current_vehicle_assign.assigned_date|date:"d M, Y" }}</div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Istemara Expiry</label>
                <div class=" text-lg ">{{ current_vehicle_assign.vehicle.istemara_expiry_date|date:"d M, Y" }}</div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Insurance Expiry</label>
                <div class=" text-lg ">{{ current_vehicle_assign.vehicle.insurance_expiry_date|date:"d M, Y" }}</div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Vehicle Assignment History -->
    {% if vehicle_assignments %}
    <div class="  rounded-xl p-6 mb-6 shadow-none">
        <h3 class=" text-2xl border-b-2  pb-3 mb-5">Vehicle Assignment History</h3>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="  border-b-2 ">
                    <tr>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Plate No</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Vehicle Type</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Ownership</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Assigned Date</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Status</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Remarks</th>
                    </tr>
                </thead>
                <tbody class="divide-y ">
                    {% for assign in vehicle_assignments %}
                    <tr class="hover:bg-gray-100 transition-colors duration-200">
                        <td class="px-4 py-4  ">{{ assign.vehicle.plate_no }}</td>
                        <td class="px-4 py-4 ">{{ assign.vehicle.get_vehicle_type_display }}</td>
                        <td class="px-4 py-4 ">{{ assign.vehicle.get_ownership_display }}</td>
                        <td class="px-4 py-4 ">{{ assign.assigned_date|date:"d M, Y" }}</td>
                        <td class="px-4 py-4 ">
                            <span
                                class="inline-block px-3 py-1 rounded-full text-sm    border ">
                                {% if assign.is_active %}Active{% else %}Inactive{% endif %}
                            </span>
                        </td>
                        <td class="px-4 py-4 ">{{ assign.remarks|default:"-" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="text-center py-10  italic bg-gray-100 rounded-xl my-5">No vehicle assignments found</div>
    {% endif %}

    <!-- Vehicle Handover History -->
    {% if vehicle_handovers_from or vehicle_handovers_to %}
    <div class="  rounded-xl p-6 mb-6 shadow-none">
        <h3 class=" text-2xl border-b-2  pb-3 mb-5">Vehicle Handover History</h3>

        {% if vehicle_handovers_from %}
        <h4 class=" text-xl mt-5 mb-3">Handed Over From</h4>
        <div class="overflow-x-auto mb-5">
            <table class="w-full">
                <thead class="  border-b-2 ">
                    <tr>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Vehicle</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">To Employee</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Handover Date</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Remarks</th>
                    </tr>
                </thead>
                <tbody class="divide-y ">
                    {% for handover in vehicle_handovers_from %}
                    <tr class="hover:bg-gray-100 transition-colors duration-200">
                        <td class="px-4 py-4  ">{{ handover.vehicle.plate_no }}</td>
                        <td class="px-4 py-4 ">{{ handover.to_employee.full_name|default:"N/A" }}</td>
                        <td class="px-4 py-4 ">{{ handover.handover_date|date:"d M, Y" }}</td>
                        <td class="px-4 py-4 ">{{ handover.remarks|default:"-" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        {% if vehicle_handovers_to %}
        <h4 class=" text-xl mt-5 mb-3">Received From</h4>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="  border-b-2 ">
                    <tr>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Vehicle</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">From Employee</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Handover Date</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Remarks</th>
                    </tr>
                </thead>
                <tbody class="divide-y ">
                    {% for handover in vehicle_handovers_to %}
                    <tr class="hover:bg-gray-100 transition-colors duration-200">
                        <td class="px-4 py-4  ">{{ handover.vehicle.plate_no }}</td>
                        <td class="px-4 py-4 ">{{ handover.from_employee.full_name|default:"N/A" }}</td>
                        <td class="px-4 py-4 ">{{ handover.handover_date|date:"d M, Y" }}</td>
                        <td class="px-4 py-4 ">{{ handover.remarks|default:"-" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- Vehicle Purchases -->
    {% if vehicle_purchases %}
    <div class="  rounded-xl p-6 mb-6 shadow-none">
        <h3 class=" text-2xl border-b-2  pb-3 mb-5">Vehicle Purchase History</h3>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="  border-b-2 ">
                    <tr>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Vehicle</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Purchase Date</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Total Amount</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Down Payment</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Installment Amount
                        </th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Payment Method</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Payment Period</th>
                    </tr>
                </thead>
                <tbody class="divide-y ">
                    {% for purchase in vehicle_purchases %}
                    <tr class="hover:bg-gray-100 transition-colors duration-200">
                        <td class="px-4 py-4  ">{{ purchase.vehicle.plate_no }}</td>
                        <td class="px-4 py-4 ">{{ purchase.purchase_date|date:"d M, Y" }}</td>
                        <td class="px-4 py-4  ">{{ purchase.total_amount|floatformat:2 }} QR</td>
                        <td class="px-4 py-4 ">{{ purchase.down_payment|floatformat:2 }} QR</td>
                        <td class="px-4 py-4 ">{{ purchase.installment_amount|floatformat:2 }} QR</td>
                        <td class="px-4 py-4 ">{{ purchase.get_payment_method_display }}</td>
                        <td class="px-4 py-4 ">{{ purchase.get_payment_period_display }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Vehicle Installments -->
    {% if vehicle_installments %}
    <div class="  rounded-xl p-6 mb-6 shadow-none">
        <h3 class=" text-2xl border-b-2  pb-3 mb-5">Vehicle Installment Status</h3>

        <!-- Installment Summary -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4 mb-5">
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Total
                    Installments</label>
                <div class=" text-lg ">{{ installment_stats.total }}</div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Paid
                    Installments</label>
                <div class=" text-lg ">{{ installment_stats.paid }}</div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Pending
                    Installments</label>
                <div class=" text-lg ">{{ installment_stats.pending }}</div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Total Amount</label>
                <div class=" text-lg ">{{ installment_stats.total_amount|floatformat:2 }} QR</div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Paid Amount</label>
                <div class=" text-lg ">{{ installment_stats.paid_amount|floatformat:2 }} QR</div>
            </div>
            <div class=" p-4 rounded-lg ">
                <label class="block  text-xs  tracking-wider mb-1">Pending Amount</label>
                <div class=" text-lg ">{{ installment_stats.pending_amount|floatformat:2 }} QR</div>
            </div>
        </div>

        <!-- Installment Details -->
        <div class="overflow-x-auto mt-5">
            <table class="w-full">
                <thead class="  border-b-2 ">
                    <tr>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Vehicle</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Installment #</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Amount</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Due Date</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Paid Date</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Payment Status</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Payment Method</th>
                    </tr>
                </thead>
                <tbody class="divide-y ">
                    {% for installment in vehicle_installments %}
                    <tr class="hover:bg-gray-100 transition-colors duration-200">
                        <td class="px-4 py-4  ">{{ installment.purchase.vehicle.plate_no }}</td>
                        <td class="px-4 py-4 ">{{ installment.installment_no }}</td>
                        <td class="px-4 py-4  ">{{ installment.amount|floatformat:2 }} QR</td>
                        <td class="px-4 py-4 ">{{ installment.due_date|date:"d M, Y" }}</td>
                        <td class="px-4 py-4 ">{{ installment.paid_date|date:"d M, Y"|default:"N/A" }}</td>
                        <td class="px-4 py-4 ">
                            <span
                                class="inline-block px-3 py-1 rounded-full text-sm    border ">
                                {{ installment.get_payment_status_display }}
                            </span>
                        </td>
                        <td class="px-4 py-4 ">{{ installment.get_payment_method_display }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Traffic Violations -->
    {% if traffic_violations %}
    <div class="  rounded-xl p-6 mb-6 shadow-none">
        <h3 class=" text-2xl border-b-2  pb-3 mb-5">Traffic Violation History</h3>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="  border-b-2 ">
                    <tr>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Vehicle</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Violation Type</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Place</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Violation Date</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Remarks</th>
                    </tr>
                </thead>
                <tbody class="divide-y ">
                    {% for violation in traffic_violations %}
                    <tr class="hover:bg-gray-100 transition-colors duration-200">
                        <td class="px-4 py-4  ">{{ violation.vehicle.plate_no }}</td>
                        <td class="px-4 py-4 ">{{ violation.violation_type.name }}</td>
                        <td class="px-4 py-4 ">{{ violation.place|default:"N/A" }}</td>
                        <td class="px-4 py-4 ">{{ violation.violation_date|date:"d M, Y" }}</td>
                        <td class="px-4 py-4 ">{{ violation.remarks|default:"-" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Vehicle Maintenance -->
    {% if vehicle_maintenances %}
    <div class="  rounded-xl p-6 mb-6 shadow-none">
        <h3 class=" text-2xl border-b-2  pb-3 mb-5">Vehicle Maintenance History</h3>
        <p class="mb-5 ">
            <strong>Total Maintenance Cost:</strong>
            <span class=" text-2xl ml-2">
                {{ vehicle_stats.total_maintenance_cost|floatformat:2 }} QR
            </span>
        </p>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="  border-b-2 ">
                    <tr>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Vehicle</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Maintenance Type</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Cost</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Status</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Maintenance Date</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Remarks</th>
                    </tr>
                </thead>
                <tbody class="divide-y ">
                    {% for maintenance in vehicle_maintenances %}
                    <tr class="hover:bg-gray-100 transition-colors duration-200">
                        <td class="px-4 py-4  ">{{ maintenance.vehicle.plate_no }}</td>
                        <td class="px-4 py-4 ">{{ maintenance.maintenance_type.name }}</td>
                        <td class="px-4 py-4  ">{{ maintenance.cost|floatformat:2 }} QR</td>
                        <td class="px-4 py-4 ">
                            <span
                                class="inline-block px-3 py-1 rounded-full text-sm    border ">
                                {{ maintenance.get_status_display }}
                            </span>
                        </td>
                        <td class="px-4 py-4 ">{{ maintenance.maintenance_date|date:"d M, Y" }}</td>
                        <td class="px-4 py-4 ">{{ maintenance.remarks|default:"-" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Vehicle Accidents -->
    {% if vehicle_accidents %}
    <div class="  rounded-xl p-6 mb-6 shadow-none">
        <h3 class=" text-2xl border-b-2  pb-3 mb-5">Vehicle Accident History</h3>
        <p class="mb-5 ">
            <strong>Total Accident Damage Cost:</strong>
            <span class=" text-2xl ml-2">
                {{ vehicle_stats.total_accident_damage|floatformat:2 }} QR
            </span>
        </p>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="  border-b-2 ">
                    <tr>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Vehicle</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Accident Date</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Place</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Damage Cost</th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Insurance Claimed
                        </th>
                        <th class="px-4 py-4 text-left text-xs  tracking-wider">Remarks</th>
                    </tr>
                </thead>
                <tbody class="divide-y ">
                    {% for accident in vehicle_accidents %}
                    <tr class="hover:bg-gray-100 transition-colors duration-200">
                        <td class="px-4 py-4  ">{{ accident.vehicle.plate_no }}</td>
                        <td class="px-4 py-4 ">{{ accident.accident_date|date:"d M, Y" }}</td>
                        <td class="px-4 py-4 ">{{ accident.accident_place }}</td>
                        <td class="px-4 py-4  ">{{ accident.damage_cost|floatformat:2 }} QR</td>
                        <td class="px-4 py-4 ">
                            <span
                                class="inline-block px-3 py-1 rounded-full text-sm    border ">
                                {% if accident.insurance_claimed %}Yes{% else %}No{% endif %}
                            </span>
                        </td>
                        <td class="px-4 py-4 ">{{ accident.remarks|default:"-" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

</div>
{% endblock %}